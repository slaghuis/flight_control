# Flight Control
A behaviour tree based flight control node referred to by the ROS2 navigation stack as a Waypoint Controller. The node uses a BehaviorTree.CPP library to specify the mission. Specify the drone mission in an XML file, and start the node.

The following behaviors have been implimented.  Please note, thes behaviors all call services and actions from other nodes in this repo.

## Simple Conditions
###	BatteryOK
Listens to battery status messages published by the [flight controller](https://github.com/slaghuis/drone_mavsdk) to obtain the current battery voltage.  Compares the voltage to that specified in a node parameter and returns true if the battery has more charge than the specified threshold.

##	Behavior tree Nodes
 
###	TakeoffDrone
Calls the Takeoff action server published by the [drone_node](https://github.com/slaghuis/drone_mavsdk), resulting in the drone flying to a set altitude.
Tested: Flight ready

###	LandDrone
Calls the Land action server published by the [drone_node](https://github.com/slaghuis/drone_mavsdk), resulting in the drone landing at the current coordinates.
Tested: Flight ready

####	TargetLandDrone
Calls the Land action server published by the [lander_node](https://github.com/slaghuis/lander), resulting in the drone landing on a set ArUco marker at the provided coordinates.
Tested: No

###	MoveDrone
Calls the [navigation server](https://github.com/slaghuis/navigation_lite) navigate to pose message to fly the drone avoiding obstacles along the way.
Tested: Simulator Ready

###	SaySomething
Prints a given message to the terminal.  Great for debugging.
Tested: Flight ready

###	GenerateFilename
Reads the current system date and time and generates a file name for use by the camera. The file name will be in the format YYMMDD_HHMM.jpg
Tested: Simulator ready

###	SavePicture
Saves the current image published by the [camera node](https://github.com/slaghuis/camera_lite) to camera/image to a file.
Improvement:  Add a second input to specify the path where the file must be saved.
Tested: Simulator ready

####	LoadMap
Calls the simple service of the [map server](https://github.com/slaghuis/navigation_lite) to load a map, replacing the current map im memory.
Improvement:  Add a second input to specify the path where the file must) be saved.
Tested: No

###	SaveMap
Saves the current map generated by the [map server](https://github.com/slaghuis/navigation_lite) to disk.
Improvement:  Add a second input to specify the path where the file must be saved.
Tested: Simulator ready

# Installation

Clone this repo into the src directory of your ROS2 workspace. See the [ros2 tutorial](https://docs.ros.org/en/foxy/Tutorials/Workspace/Creating-A-Workspace.html) on how to create a workspace.
```
git clone https://github.com/slaghuis/flight_control.git
```
Back in the root of your ROS workspace, build and install the package.  
```
colcon build --packages-select flight_control
. install/setup.bash
ros2 launch flight_control flight.launch.py
```

## CAUTION
This is still a rough first draft.  Lots of testing and building out to be done.

